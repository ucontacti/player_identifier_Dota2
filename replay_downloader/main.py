match_id_list = [
        "6164254985",
        "6164160027",
        "6164009449",
        "6163895523",
        "6163825313",
        "6163736145",
        "6163703623",
        "6163672885",
        "6162491641",
        "6162465646",
        "6162269102",
        "6162214455",
        "6162149008",
        "6162103510",
        "6159786872",
        "6159642035",
        "6159598663",
        "6159554492",
        "6159507865",
        "6158301305",
        "6158277421",
        "6158254117",
        "6158070047",
        "6157912475",
        "6157862440",
        "6157794965",
        "6157735864",
        "6157573994",
        "6157393999",
        "6155796820",
        "6155433583",
        "6155398155",
        "6155295638",
        "6155217805",
        "6155162563",
        "6155061265",
        "6153622329",
        "6153579981",
        "6153551833",
        "6153475849",
        "6153430458",
        "6153392684",
        "6152112354",
        "6152064867",
        "6151984329",
        "6151703187",
        "6151445964",
        "6151248559",
        "6151198179",
        "6149882850",

        "6163772426",
        "6163737015",
        "6163701751",
        "6163578201",
        "6163530945",
        "6163407127",
        "6162441562",
        "6162176883",
        "6162109897",
        "6161096263",
        "6160691609",
        "6159576691",
        "6159519900",
        "6159445398",
        "6159395126",
        "6159308344",
        "6159220873",
        "6158036703",
        "6157784964",
        "6157726715",
        "6157618074",
        "6157403935",
        "6157333912",
        "6157260984",
        "6157195303",
        "6157142492",
        "6156674440",
        "6156488397",
        "6156416692",
        "6156357524",
        "6156178921",
        "6156066716",
        "6155989268",
        "6155925846",
        "6155811495",
        "6155744991",
        "6155691925",
        "6155627402",
        "6154907782",
        "6154841027",
        "6154479090",
        "6153297446",
        "6153180032",
        "6151920922",
        "6151806217",
        "6151741341",
        "6151680123",
        "6150503111",
        "6150453279",
        "6150376609",
        "6150208625",

        "6164171192",
        "6164120130",
        "6163627032",
        "6163264084",
        "6163204533",
        "6163084685",
        "6163029252",
        "6162860305",
        "6162831425",
        "6162711994",
        "6162645256",
        "6162624659",
        "6162140243",
        "6161882489",
        "6161767305",
        "6161712904",
        "6161630688",
        "6161507987",
        "6161438532",
        "6161344987",
        "6161279921",
        "6161242116",
        "6160482862",
        "6160353906",
        "6160298309",
        "6160086559",
        "6160000573",
        "6159893131",
        "6159853249",
        "6159820557",
        "6159763273",
        "6159736463",
        "6159586639",
        "6158862214",
        "6158808288",
        "6158749680",
        "6158711074",
        "6158605247",
        "6158576813",
        "6158547449",
        "6158413161",
        "6158382465",
        "6158349252",
        "6158318069",
        "6158292808",
        "6158266530",
        "6158176626",
        "6158127338",
        "6158032092",
        "6157940172",
        "6157028794",
        "6156941664",
        "6156808270",
        "6156491125",
        "6156439527",
        "6156072747",
        "6155316636",
        "6155264863",
        "6155152171",
        "6155121125",
        "6155082126",
        "6154746183",
        "6153743515",
        "6153686273",
        "6153579142",
        "6150724591",
]



import requests, json
import urllib
import socks
from sockshandler import SocksiPyHandler
from socks5_auth import socks5user, socks5pass

counter = 1
for match in match_id_list:
    stringurl = "https://api.opendota.com/api/replays?match_id=" + match
    raw_data = requests.get(stringurl, allow_redirects=True)
    json_data = json.loads(raw_data.content.decode())

    demo_url = "http://replay" + str(json_data[0]["cluster"]) + ".valve.net/570/" + str(json_data[0]["match_id"]) + "_" + str(json_data[0]["replay_salt"]) + ".dem.bz2"
    save_to = "/media/hap/normal/replays/" + match + ".dem.bz2"
    print("Getting ready to download replay " + str(counter) + " match_id: " + match)


    # proxy = SocksiPyHandler(socks.SOCKS5, "amsterdam.nl.socks.nordhold.net", 1080, username=socks5user, password=socks5pass)
    # opener = urllib.request.build_opener(proxy)
    # urllib.request.install_opener(opener)
    
    # requestt = urllib.request.urlopen("http://ip.42.pl/raw").read()
    # print(requestt)
    print(demo_url)
    
    urllib.request.urlretrieve(demo_url, save_to)
    print("Downloaded replay " + str(counter))
    counter += 1